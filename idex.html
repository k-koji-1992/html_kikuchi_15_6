<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css">
    <title>EATEDRIVE</title>
</head>

<body>
<div>
    <header class="header">
        <div class="logo">
         <img src="./img/header_logo.png" alt="">
        </div>
  
        <nav>
          <ul>
            <li> <a href="#about" class="about">このサイトについて</a></li>
            <li> <a href="#course" class="map"></a>マップ</li>
            <li> <a href="#news" class="news">お知らせ</a></li>
            <li> <a href="#register" class="register"></a>会員登録</li>
            <li> <a href="#contact" class="contact">お問い合わせ</a></li>
          </ul>
        </nav>
      </header>
</div>



<!-- MAP[START] -->
<div id="myMap" style="width:500px;height:500px;"></div>
<!-- MAP[END] -->
<!--Directions[START]-->
<div>
    From:<input type="text" id="from" placeholder="出発地">
    To:<input id="to" placeholder="目的地">
    <select id="mode" >
        <option value="walking">徒歩</option>
        <option value="driving">自動車</option>
        <option value="train">電車</option>
    </select>
    <input type="button" id="search" value="ルート検索">
</div>
<div id="direction"></div>
<!-- Directions[END] -->

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
        src='https://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=' async defer></script>
    <script src="https://cdn.jsdelivr.net/gh/yamazakidaisuke/BmapQuery/js/BmapQuery.js"></script>

    <script>


var map; // グローバル変数

        function GetMap(lat, lon) {
            map = new Bmap("#myMap");
            map.startMap(lat, lon, "load", 20);
        };

        function mapsInit(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            GetMap(lat, lon);
        };

        function mapsError(error) {
            let e = "";
            // Error handling code
            alert("エラー：" + e);
        };

        var set = {
            // Position options
        };

        navigator.geolocation.getCurrentPosition(mapsInit, mapsError, set);

        document.getElementById("search").addEventListener("click", function() {
            searchRoute(
                document.getElementById("from").value,
                document.getElementById("to").value,
                document.getElementById("mode").value
            );
        });

        function searchRoute(from, to, mode) {
            // ルート検索のオプション
            let routeOption = {
                travelMode: mode.toUpperCase()
            };

            // ルート検索
            map.routeSearch(from, to, routeOption, function (error, result) {
                if (error) {
                    console.error(error);
                    alert("ルート検索に失敗しました。");
                } else {
                    map.setView(result.routes[0].getBounds(), "load");
                }
            });
        }
        function GetMap(lat, lon) {
            //1. Init
            let map = new Bmap("#myMap");
            //2. map.startMap(lat, lon, "MapType", Zoom[1~20]);
            map.startMap(lat, lon, "load", 20);
            let pin = map.pin(lat, lon, "#ff0000");
        };
        // 1．位置情報の取得に成功した時の処理
        function mapsInit(position) {
            //lat=緯度、lon=経度 を取得
            console.log(position);
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            console.log(lat, lon);
            GetMap(lat,lon);
            map.startMap(let, lon, "load", 15);
        };
        //2． 位置情報の取得に失敗した場合の処理
        function mapsError(error) {
            let e = "";
            if (error.code == 1) { //1＝位置情報取得が許可されてない（ブラウザの設定）
                e = "位置情報が許可されてません";
            }
            if (error.code == 2) { //2＝現在地を特定できない
                e = "現在位置を特定できません";
            }
            if (error.code == 3) { //3＝位置情報を取得する前にタイムアウトになった場合
                e = "位置情報を取得する前にタイムアウトになりました";
            }
            alert("エラー：" + e);
        };

        //3.位置情報取得オプション
        var set = {
            enableHighAccuracy: true, //より高精度な位置を求める
            maximumAge: 20000,        //最後の現在地情報取得が20秒以内であればその情報を再利用する設定
            timeout: 10000            //10秒以内に現在地情報を取得できなければ、処理を終了
        };

      
        document.getElementById("search").onclick = function () {
        //Get From,To
        const from  = document.getElementById("from").value;  //StartPoint
        const to    = document.getElementById("to").value;    //EndPoint
        const mode  = document.getElementById("mode").value;  //RouteMode[walking,driving]                     //Waypoints...
        map.direction("#direction", mode, from, to);  //Direction Methed

    };



    </script>

</body>
</html>